"use strict";(self.webpackChunkjs=self.webpackChunkjs||[]).push([[179],{36:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Biquad=void 0;class o{constructor(t=0,e=0,o=0,s=0,r=0){this.a1=t,this.a2=e,this.b0=o,this.b1=s,this.b2=r,this.xz1=0,this.xz2=0,this.yz1=0,this.yz2=0}static create_bandpass(t,e,s,r){const i=Math.pow(10,e/40),n=2*Math.PI*t/r,a=Math.sin(n),c=Math.cos(n),l=a/(2*s),h=1+l/i;return new o(-2*c/h,(1-l/i)/h,(1+l*i)/h,-2*c/h,(1-l*i)/h)}reset(){this.xz1=0,this.xz2=0,this.yz1=0,this.yz2=0}apply(t){const e=this.a1,o=this.a2,s=this.b0,r=this.b1,i=this.b2;let n=this.xz1,a=this.xz1,c=this.yz1,l=this.yz2;const h=t.length;new Float32Array(h);for(let u=0;u<h;++u){const h=t[u],d=h*s+n*r+a*i-c*e-l*o;t[u]=d,a=n,n=h,l=c,c=d}this.xz1=n,this.xz2=n,this.yz1=c,this.yz2=l}}e.Biquad=o},450:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ControlsView=void 0;const s=o(629),r=o(803);e.ControlsView=class{constructor(t){this.model=t}bind(t){const e=r.select("aside").selectAll("label.control.q").data([1]).enter().append("label").attr("class","control q");e.append("span").attr("class","control-name q").text("q"),e.append("input").attr("class","slider q").attr("type","range").attr("min","-10").attr("max","10").attr("value",0).on("input",(e=>t.set_q(Math.pow(10,e.currentTarget.value/10)))),e.append("span").attr("class","control-value q").text("");const o=r.select("aside").selectAll("label.control.eq.g").data(s.eq_freq.map(((t,e)=>({x:t,i:e})))).enter().append("label").attr("class","control eq g");o.append("span").attr("class","control-name eq").text((({x:t})=>t<1e3?`${t}`:t/1e3+"k")),o.append("input").attr("class","slider eq").attr("type","range").attr("min","-32").attr("max","32").attr("value",0).on("input",((e,{i:o})=>t.set_gain(o,e.currentTarget.value))),o.append("span").attr("class","control-value eq").text("")}update(){const t=this.model,e=r.select("aside").selectAll("label.control.q").data([t.q]);e.select(".slider.q").attr("value",(e=>Math.round(10*Math.log10(t.q)))),e.select(".control-value.q").text((t=>t.toFixed(1)));const o=r.select("aside").selectAll("label.control.eq").data(t.eq);o.select(".slider.eq").attr("value",(t=>t.g)),o.select(".control-value.eq").text((t=>`${t.g}dB`))}}},609:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CursorView=void 0;const s=o(803);e.CursorView=class{constructor(t){this.model=t,this.node=s.select(".cursor")}bind(t){this.node.append("span").attr("class","cursor-x"),this.node.append("span").attr("class","cursor-y"),this.node.append("span").attr("class","cursor-v")}update(){var t;const{cursor_f:e,cursor_db:o,value_db:s}=this.model.cursor;this.node.select(".cursor-x").text(`x: ${e.toFixed(0)} Hz`),this.node.select(".cursor-y").text(`y: ${o.toFixed(2)} dB`),this.node.select(".cursor-v").text(`value: ${null!==(t=null==s?void 0:s.toFixed(2))&&void 0!==t?t:"-"} dB`)}}},74:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultModel=void 0;const s=o(629);e.DefaultModel=class{constructor(t){this.strategy=t,this.q=1,this.eq=s.eq_freq.map(((t,e)=>({i:e,f:t,g:0,q:1}))),this.cursor={cursor_f:0,cursor_db:0,value_db:null},this.spectrum=new Float32Array(0),this.update_eq()}interpolate_db(t){const e=this.spectrum;for(let o=0;o<e.length-2;o+=2){const s=e[o],r=e[o+2];if(t>=s&&t<=r&&r>s){const i=(t-s)/(r-s),n=e[o+1];return n+i*(e[o+3]-n)}}return null}update_cursor(){this.cursor.value_db=this.interpolate_db(this.cursor.cursor_f)}update_eq(){this.spectrum=this.strategy.calculate(this.eq),this.update_cursor()}set_q(t){this.q=t;for(const e of this.eq)e.q=t;this.update_eq()}set_gain(t,e){this.eq[t].g=e,this.update_eq()}set_cursor(t,e){this.cursor={cursor_f:t,cursor_db:e,value_db:null},this.update_cursor()}}},522:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Equaliser=void 0;const s=o(36);e.Equaliser=class{constructor(t,e){const{rate:o}=t;this.filters=e.map((({f:t,g:e,q:r})=>s.Biquad.create_bandpass(t,e,r,o)))}apply(t){for(const e of this.filters)e.apply(t)}}},575:function(t,e,o){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.FourierStrategy=void 0;const r=o(805),i=o(250),n=o(522),a=s(o(664));e.FourierStrategy=class{constructor(t){this.config=t,this.fft=new a.default(t.size),this.signal=new i.SignalFactory(t).generate_noise(),this.baseline=this.get_spectrum(this.signal)}get_spectrum(t){const e=new r.Mapping(this.config),{size:o}=this.config,s=new Float32Array(2*o);this.fft.realTransform(s,[...t]);const i=new Float32Array(o);for(let r=0;r<o;r+=2){const o=Math.hypot(s[r],s[r+1])/Math.sqrt(t.length)/128;i[r]=e.i_to_f(r/2),i[r+1]=o}return i}calculate(t){const e=new r.Mapping(this.config),{size:o}=this.config,s=new Float32Array(this.signal);new n.Equaliser(this.config,t).apply(s);const i=this.get_spectrum(s);for(let t=1;t<i.length;t+=2)i[t]=e.level_to_db(i[t]/this.baseline[t]);return i}}},132:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MainController=void 0,e.MainController=class{constructor(t,e,o){this.config=t,this.model=e,this.views=o;for(const t of this.views)t.bind(this);this.update()}update(){for(const t of this.views)t.update()}set_q(t){this.model.set_q(t),this.update()}set_gain(t,e){this.model.set_gain(t,e),this.update()}set_cursor(t,e){this.model.set_cursor(t,e),this.update()}}},805:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mapping=void 0;const o=.01,s=.98;e.Mapping=class{constructor(t,e=null,o=-60,s=60){var r,i;this.config=t,this.db_min=o,this.db_max=s,this.fmin=10,this.fmax=Math.min(2e4,t.rate/2),this.width=null!==(r=null==e?void 0:e.width)&&void 0!==r?r:0,this.height=null!==(i=null==e?void 0:e.height)&&void 0!==i?i:0}project(t,e){const{width:r,height:i}=this;return[(t*s+o)*r,(e*s+o)*i]}level_to_db(t){const{db_min:e,db_max:o}=this;return Math.min(o,Math.max(e,20*Math.log10(t)))}i_to_f(t){const{rate:e,size:o}=this.config;return t*e/o}f_to_i(t){const{size:e,rate:o}=this.config;return Math.min(e/2-1,Math.max(0,Math.round(t*e/o)))}project_x(t,e,o){const s=Math.log(t),r=Math.log(e);return(s-r)/(Math.log(o)-r)}project_f(t){return this.project_x(t,this.fmin,this.fmax)}project_db(t){const{db_min:e,db_max:o}=this;return(o-t)/(o-e)}unproject(t,e){const{width:r,height:i}=this;return[(t/r-o)/s,(e/i-o)/s]}unproject_f(t){const{fmin:e,fmax:o}=this,s=Math.log(e),r=Math.log(o);return Math.exp(t*(r-s)+s)}unproject_i(t){const{size:e,rate:o}=this.config,s=this.unproject_f(t);return this.f_to_i(Math.round(s*e/o))}unproject_db(t){const{db_min:e,db_max:o}=this;return o-t*(o-e)}}},781:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SerialStrategy=void 0;const s=o(805),r=o(522),i=o(250);e.SerialStrategy=class{constructor(t){this.config=t;const{rate:e}=this.config,o=new s.Mapping(this.config),r=0|Math.floor(Math.log10(o.fmin)),n=20*((0|Math.ceil(Math.log10(o.fmax)))-r);this.sines=new Array(n).fill(null).map(((t,o)=>{const s=o/20+r,n=Math.pow(10,s),a=e/n;return{f:n,y:new i.SignalFactory({size:a,rate:e}).generate_sine(n)}}))}calculate(t){const e=new s.Mapping(this.config),o=new Float32Array(2*this.sines.length);let i=0;for(const{f:s,y:n}of this.sines){const a=new Float32Array(n);new r.Equaliser(this.config,t).apply(a);const c=a.reduce(((t,e)=>Math.max(t,Math.abs(e))),0),l=e.level_to_db(c);o[i++]=s,o[i++]=l}return o}}},250:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SignalFactory=void 0,e.SignalFactory=class{constructor(t){this.config=t}generate_all(){return{noise:this.generate_noise(),pure:this.generate_sine(this.config.rate/4)}}generate_noise(){const{size:t}=this.config,e=new Float32Array(t);for(let o=0;o<t;++o)e[o]+=(2*Math.random()-1)*Math.sqrt(t)*2;return e}generate_sine(t){const{size:e,rate:o}=this.config,s=new Float32Array(e);for(let r=0;r<e;++r)s[r]=Math.sin(2*Math.PI*t*r/o);return s}}},685:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SpectrumView=void 0;const s=o(805),r=o(59),i=o(803);e.SpectrumView=class{constructor(t,e){this.config=t,this.model=e;const o=i.select(".viewer");this.node=o.node(),this.context=this.node.getContext("2d")}onresize(){const t=this.node.clientWidth,e=this.node.clientHeight,o=window.devicePixelRatio;this.node.width=Math.round(t*o),this.node.height=Math.round(e*o),this.update()}onmovecursor(t,e,o){const r=i.select(".viewer").node(),{rate:n,size:a}=this.config,c=new s.Mapping(this.config,r),[l,h]=c.unproject(e*devicePixelRatio,o*devicePixelRatio),u=c.unproject_f(l),d=c.unproject_db(h);t.set_cursor(u,d)}onmousemove(t,e){1&e.buttons&&this.onmovecursor(t,e.clientX,e.clientY)}ontouchmove(t,e){const o=e.touches.item(0);null!==o&&this.onmovecursor(t,o.clientX,o.clientY)}bind(t){new ResizeObserver(r.debounce((()=>this.onresize()),40,{leading:!0,trailing:!0})).observe(this.node),this.node.addEventListener("mousemove",(e=>this.onmousemove(t,e))),this.node.addEventListener("touchmove",(e=>this.ontouchmove(t,e)))}update(){const t=this.config,e=this.model,o=this.node,r=this.context,i=o.width,n=o.height;r.clearRect(0,0,i,n);const a=new s.Mapping(t,o),{db_min:c,db_max:l}=a;r.globalCompositeOperation="lighter";{r.lineWidth=2,r.strokeStyle="red",r.beginPath(),r.moveTo(...a.project(a.project_f(a.fmin),a.project_db(0)));const t=e.spectrum;for(let e=0;e<t.length;e+=2){const o=t[e],s=t[e+1];o>=a.fmin&&o<=a.fmax&&r.lineTo(...a.project(a.project_f(o),a.project_db(s)))}r.stroke()}r.strokeStyle="orange",r.lineWidth=4,r.beginPath(),r.moveTo(...a.project(a.project_f(a.fmin),a.project_db(0)));for(const{f:t,g:o}of e.eq)r.lineTo(...a.project(a.project_f(t),a.project_db(o)));r.lineTo(...a.project(a.project_f(a.fmax),a.project_db(0))),r.stroke(),r.lineWidth=6;for(const{f:t,g:o}of e.eq){const[e,s]=a.project(a.project_f(t),a.project_db(o));r.beginPath(),r.rect(e-1/i,s-1/n,2/i,2/n),r.stroke()}for(let t=a.fmin;t<a.fmax;t*=10)for(let e=1;e<10&&t*e<a.fmax;e++)r.lineWidth=1==e?4:2,r.strokeStyle=1==e?"blue":"green",r.beginPath(),r.moveTo(...a.project(a.project_f(t*e),0)),r.lineTo(...a.project(a.project_f(t*e),1)),r.stroke();for(let t=6*Math.ceil(c/6);t<=l;t+=6)r.lineWidth=0==t?4:2,r.strokeStyle=0==t?"blue":"green",r.beginPath(),r.moveTo(...a.project(0,a.project_db(t))),r.lineTo(...a.project(1,a.project_db(t))),r.stroke();r.lineWidth=4,r.strokeStyle="silver",r.beginPath(),r.moveTo(...a.project(0,0)),r.lineTo(...a.project(1,0)),r.lineTo(...a.project(1,1)),r.lineTo(...a.project(0,1)),r.lineTo(...a.project(0,0)),r.stroke();{const t=e.cursor;r.lineWidth=8,r.strokeStyle="cyan";const o=t.cursor_f,s=t.cursor_db,c=t.value_db,[l,h]=a.project(a.project_f(o),a.project_db(s));if(r.beginPath(),r.rect(l-1/i,h-1/n,2/i,2/n),r.stroke(),null!==c){r.setLineDash([4,4]);const[t,e]=a.project(a.project_f(o),a.project_db(c));r.beginPath(),r.rect(t-1/i,e-1/n,2/i,2/n),r.stroke(),r.lineWidth=2,r.beginPath(),r.moveTo(l,h),r.lineTo(t,e),r.stroke(),r.setLineDash([])}}}}},629:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.eq_freq=void 0,e.eq_freq=[25,31.5,40,50,63,80,100,125,160,200,250,315,400,500,630,800,1e3,1250,1600,2e3,2500,3150,4e3,5e3,6300,8e3,1e4,12500,16e3,2e4]},4:(t,e,o)=>{const s=o(74),r=o(450),i=o(685),n=o(609),a=o(132),c=o(575),l=o(781);!function(){const t=window.location.hash.replace(/^#/,"")||"fourier",e={fourier:{rate:65536,size:32768},sines:{rate:6e4,size:2e4}}[t],o={fourier:()=>new c.FourierStrategy(e),sines:()=>new l.SerialStrategy(e)}[t](),h=new s.DefaultModel(o),u=[new r.ControlsView(h),new n.CursorView(h),new i.SpectrumView(e,h)];new a.MainController(e,h,u)}()}},t=>{t.O(0,[216],(()=>(4,t(t.s=4)))),t.O()}]);
//# sourceMappingURL=main.js.map