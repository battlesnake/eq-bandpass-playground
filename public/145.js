(()=>{"use strict";const t=.01,s=.98;class i{constructor(t,s=null,i=-60,e=60){var n,r;this.config=t,this.db_min=i,this.db_max=e,this.fmin=10,this.fmax=Math.min(2e4,t.rate/2),this.width=null!==(n=null==s?void 0:s.width)&&void 0!==n?n:0,this.height=null!==(r=null==s?void 0:s.height)&&void 0!==r?r:0}project(i,e){const{width:n,height:r}=this;return[(i*s+t)*n,(e*s+t)*r]}level_to_db(t){const{db_min:s,db_max:i}=this;return Math.min(i,Math.max(s,20*Math.log10(t)))}i_to_f(t){const{rate:s,size:i}=this.config;return t*s/i}f_to_i(t){const{size:s,rate:i}=this.config;return Math.min(s/2-1,Math.max(0,Math.round(t*s/i)))}project_x(t,s,i){const e=Math.log(t),n=Math.log(s);return(e-n)/(Math.log(i)-n)}project_f(t){return this.project_x(t,this.fmin,this.fmax)}project_db(t){const{db_min:s,db_max:i}=this;return(i-t)/(i-s)}unproject(i,e){const{width:n,height:r}=this;return[(i/n-t)/s,(e/r-t)/s]}unproject_f(t){const{fmin:s,fmax:i}=this,e=Math.log(s),n=Math.log(i);return Math.exp(t*(n-e)+e)}unproject_i(t){const{size:s,rate:i}=this.config,e=this.unproject_f(t);return this.f_to_i(Math.round(e*s/i))}unproject_db(t){const{db_min:s,db_max:i}=this;return i-t*(i-s)}}class e{constructor(t=0,s=0,i=0,e=0,n=0){this.a1=t,this.a2=s,this.b0=i,this.b1=e,this.b2=n,this.xz1=0,this.xz2=0,this.yz1=0,this.yz2=0}static create_bandpass(t,s,i,n){const r=Math.pow(10,s/40),h=2*Math.PI*t/n,a=Math.sin(h),o=Math.cos(h),c=a/(2*i),l=1+c/r;return new e(-2*o/l,(1-c/r)/l,(1+c*r)/l,-2*o/l,(1-c*r)/l)}reset(){this.xz1=0,this.xz2=0,this.yz1=0,this.yz2=0}apply(t){const s=this.a1,i=this.a2,e=this.b0,n=this.b1,r=this.b2;let h=this.xz1,a=this.xz1,o=this.yz1,c=this.yz2;const l=t.length;new Float32Array(l);for(let f=0;f<l;++f){const l=t[f],u=l*e+h*n+a*r-o*s-c*i;t[f]=u,a=h,h=l,c=o,o=u}this.xz1=h,this.xz2=h,this.yz1=o,this.yz2=c}}class n{constructor(t,s){const{rate:i}=t;this.filters=s.map((({f:t,g:s,q:n})=>e.create_bandpass(t,s,n,i)))}apply(t){for(const s of this.filters)s.apply(t)}}class r{constructor(t){this.config=t}generate_all(){return{noise:this.generate_noise(),pure:this.generate_sine(this.config.rate/4)}}generate_noise(){const{size:t}=this.config,s=new Float32Array(t);for(let i=0;i<t;++i)s[i]+=(2*Math.random()-1)*Math.sqrt(t)*2;return s}generate_sine(t){const{size:s,rate:i}=this.config,e=new Float32Array(s);for(let n=0;n<s;++n)e[n]=Math.sin(2*Math.PI*t*n/i);return e}}class h{constructor(t,s){this.config=t,this.freq=s;const{rate:i}=t,e=i/s,n=4*e;this.sine=new r({size:n,rate:i}).generate_sine(s),this.period=e}calculate(t){const s=new i(this.config),e=new Float32Array(this.sine);new n(this.config,t).apply(e);const r=e.subarray(3*this.period).reduce(((t,s)=>Math.max(t,Math.abs(s))),0);return{freq:this.freq,db:s.level_to_db(r)}}}let a;self.onmessage=function({data:t}){if("init"===t.type){const{config:s,freq:i}=t;a=new h(s,i)}var s;if(a&&"job"===t.type){const{id:i,bands:e}=t,{freq:n,db:r}=a.calculate(e);s={type:"result",id:i,freq:n,db:r},self.postMessage(s)}}})();
//# sourceMappingURL=145.js.map