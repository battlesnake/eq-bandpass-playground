"use strict";(self.webpackChunkjs=self.webpackChunkjs||[]).push([[539],{36:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Biquad=void 0;class s{constructor(t=0,e=0,s=0,i=0,n=0){this.a1=t,this.a2=e,this.b0=s,this.b1=i,this.b2=n,this.xz1=0,this.xz2=0,this.yz1=0,this.yz2=0}static create_bandpass(t,e,i,n){const r=Math.pow(10,e/40),a=2*Math.PI*t/n,o=Math.sin(a),h=Math.cos(a),c=o/(2*i),l=1+c/r;return new s(-2*h/l,(1-c/r)/l,(1+c*r)/l,-2*h/l,(1-c*r)/l)}reset(){this.xz1=0,this.xz2=0,this.yz1=0,this.yz2=0}apply(t){const e=this.a1,s=this.a2,i=this.b0,n=this.b1,r=this.b2;let a=this.xz1,o=this.xz1,h=this.yz1,c=this.yz2;const l=t.length;new Float32Array(l);for(let u=0;u<l;++u){const l=t[u],f=l*i+a*n+o*r-h*e-c*s;t[u]=f,o=a,a=l,c=h,h=f}this.xz1=a,this.xz2=a,this.yz1=h,this.yz2=c}}e.Biquad=s},522:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Equaliser=void 0;const i=s(36);e.Equaliser=class{constructor(t,e){const{rate:s}=t;this.filters=e.map((({f:t,g:e,q:n})=>i.Biquad.create_bandpass(t,e,n,s)))}apply(t){for(const e of this.filters)e.apply(t)}}},805:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mapping=void 0;const s=.01,i=.98;e.Mapping=class{constructor(t,e=null,s=-60,i=60){var n,r;this.config=t,this.db_min=s,this.db_max=i,this.fmin=10,this.fmax=Math.min(2e4,t.rate/2),this.width=null!==(n=null==e?void 0:e.width)&&void 0!==n?n:0,this.height=null!==(r=null==e?void 0:e.height)&&void 0!==r?r:0}project(t,e){const{width:n,height:r}=this;return[(t*i+s)*n,(e*i+s)*r]}level_to_db(t){const{db_min:e,db_max:s}=this;return Math.min(s,Math.max(e,20*Math.log10(t)))}i_to_f(t){const{rate:e,size:s}=this.config;return t*e/s}f_to_i(t){const{size:e,rate:s}=this.config;return Math.min(e/2-1,Math.max(0,Math.round(t*e/s)))}project_x(t,e,s){const i=Math.log(t),n=Math.log(e);return(i-n)/(Math.log(s)-n)}project_f(t){return this.project_x(t,this.fmin,this.fmax)}project_db(t){const{db_min:e,db_max:s}=this;return(s-t)/(s-e)}unproject(t,e){const{width:n,height:r}=this;return[(t/n-s)/i,(e/r-s)/i]}unproject_f(t){const{fmin:e,fmax:s}=this,i=Math.log(e),n=Math.log(s);return Math.exp(t*(n-i)+i)}unproject_i(t){const{size:e,rate:s}=this.config,i=this.unproject_f(t);return this.f_to_i(Math.round(i*e/s))}unproject_db(t){const{db_min:e,db_max:s}=this;return s-t*(s-e)}}},7:(t,e,s)=>{const i=s(805),n=s(522),r=s(250);class a{constructor(t,e){this.config=t,this.freq=e;const{rate:s}=t,i=s/e;this.sine=new r.SignalFactory({size:i,rate:s}).generate_sine(e)}calculate(t){const e=new i.Mapping(this.config),s=new Float32Array(this.sine);new n.Equaliser(this.config,t).apply(s);const r=s.reduce(((t,e)=>Math.max(t,Math.abs(e))),0);return{freq:this.freq,db:e.level_to_db(r)}}}let o;self.onmessage=function({data:t}){if(console.log("Message in worker",t),"init"===t.type){const{config:e,freq:s}=t;o=new a(e,s)}var e;if(o&&"job"===t.type){const{id:s,bands:i}=t,{freq:n,db:r}=o.calculate(i);e={type:"result",id:s,freq:n,db:r},self.postMessage(e)}}},250:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SignalFactory=void 0,e.SignalFactory=class{constructor(t){this.config=t}generate_all(){return{noise:this.generate_noise(),pure:this.generate_sine(this.config.rate/4)}}generate_noise(){const{size:t}=this.config,e=new Float32Array(t);for(let s=0;s<t;++s)e[s]+=(2*Math.random()-1)*Math.sqrt(t)*2;return e}generate_sine(t){const{size:e,rate:s}=this.config,i=new Float32Array(e);for(let n=0;n<e;++n)i[n]=Math.sin(2*Math.PI*t*n/s);return i}}}},t=>{t(t.s=7)}]);
//# sourceMappingURL=SerialWorker.js.map